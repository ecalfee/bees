# global ancestry assessed by
# (1) PCA
# (2) NGSAdmix
# All implemented in ANGSD based off of genotype likelihoods at SNPs in low LD

# SNPs need to be in low LD for this analysis.
# for input files in results/input/, I concatenate the GL for every 1000th SNP for ordered scaffolds:
# first make a list of gl files in order (different order will give different SNPs):
bees/global_ancestry$ for i in $(cat ../data/honeybee_genome/ordered_scaffolds.list); do echo "scaffold_$i.beagle.gz"; done > results/input/ordered_scaffolds.GL.files
# then thin to every 1000th SNP:
bees/global_ancestry$ nohup ./catBeagleGL_nth.sh 1000 ordered_scaffolds ../geno_lik_and_SNPs/results/pass1_GL_by_scaffold >& logs/prune_ordered_scaffolds_by1000.out &
[1] 22451 - COMPLETE (few minutes) # about 3k snps
# also pruning by every 250 SNPs
bees/global_ancestry$ nohup ./catBeagleGL_nth.sh 250 ordered_scaffolds ../geno_lik_and_SNPs/results/pass1_GL_by_scaffold >& logs/prune_ordered_scaffolds_by250.out &
[1] 1443 - COMPLETE

# run PCAngsd (note: first need to install pcangsd.py, python2, pip2, and using pip2 all the dependencies, e.g. numpy, listed here: http://www.popgen.dk/software/index.php/PCAngsd)
bees/global_ancestry$ nohup ./runPCAngsd.sh ordered_scaffolds_prunedBy250 >& logs/runPCA_ordered_scaffolds_prunedBy250.out &
[1] 14723 - COMPLETE (seconds)

bees/global_ancestry$ nohup ./runPCAngsd.sh ordered_scaffolds_prunedBy1000 >& logs/runPCA_ordered_scaffolds_prunedBy1000.out &
[2] 15018 - COMPLETE (seconds)

# run NGSAdmix
bees/global_ancestry$ nohup ./runNGSadmix.sh 3 ordered_scaffolds_prunedBy250 &> logs/runNGSadmix_ordered_scaffolds_prunedBy250.out &
[1] 13386 - COMPLETE (seconds)

bees/global_ancestry$ nohup ./runNGSadmix.sh 3 ordered_scaffolds_prunedBy1000 &> logs/runNGSadmix_ordered_scaffolds_prunedBy1000.out &
[1] 13376 - COMPLETE (seconds)

# checking for O ancestry with NGSAdmix K = 4
bees/global_ancestry$ nohup ./runNGSadmix.sh 4 ordered_scaffolds_prunedBy1000 &> logs/runNGSadmix_ordered_scaffolds_prunedBy1000_K4.out &
[2] 3597 - COMPLETED (seconds)
bees/global_ancestry$ nohup ./runNGSadmix.sh 4 ordered_scaffolds_prunedBy250 &> logs/runNGSadmix_ordered_scaffolds_prunedBy250_K4.out &
[2] 3639 - COMPLETED (seconds)


# (1) pruning new GL's pass1 plus kohn, take every nth SNP:
global_ancestry$ nohup ./catBeagleGL_nth.sh 1000 ordered_scaffolds_pass1_plus_kohn ../geno_lik_and_SNPs/results/pass1_plus_kohn_GL_by_scaffold >& logs/prune_ordered_scaffolds_pass1_plus_kohn_by1000.out &
[1] 10392 - COMPLETED 2.4.19
# also pruning by every 250 SNPs
global_ancestry$ nohup ./catBeagleGL_nth.sh 251 ordered_scaffolds_pass1_plus_kohn ../geno_lik_and_SNPs/results/pass1_plus_kohn_GL_by_scaffold >& logs/prune_ordered_scaffolds_pass1_plus_kohn_by251.out &
[2] 11094 - COMPLETED 2.4.19

# (2) running NGSadmix on pass1 plus kohn dataset:
global_ancestry$ nohup parallel --no-swap --jobs 4 --joblog logs/runNGSadmix_ordered_scaffolds_pass1_plus_kohn.log './runNGSadmix.sh {1} ordered_scaffolds_pass1_plus_kohn_prunedBy{2}' ::: 2 3 4 ::: 1000 251 &> logs/runNGSadmix_ordered_scaffolds_pass1_plus_kohn.out &
[1] 1250 - RUNNING 2.4.19


# made multiple R scripts for plotting results:
plot_PCA.R
plot_NGSadmix.R
plot_admixture_by_PCA.R # shows congruence between these two global ancestry analyses
